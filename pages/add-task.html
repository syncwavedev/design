<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="/public/main.css" rel="stylesheet" />
    <script>
      let currentTheme = "light";

      function setTheme(theme) {
        document.documentElement.setAttribute("data-theme", theme);
        currentTheme = theme;
      }

      function toggleTheme() {
        const newTheme = currentTheme === "light" ? "dark" : "light";
        setTheme(newTheme);
        localStorage.setItem("theme", newTheme);
      }

      document.addEventListener("DOMContentLoaded", () => {
        // Check for browser preference
        const prefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)",
        ).matches;

        // Use saved theme if exists, otherwise use browser preference
        const savedTheme =
          localStorage.getItem("theme") || (prefersDark ? "dark" : "light");
        setTheme(savedTheme);

        // Listen for browser theme changes
        window
          .matchMedia("(prefers-color-scheme: dark)")
          .addEventListener("change", (e) => {
            if (!localStorage.getItem("theme")) {
              setTheme(e.matches ? "dark" : "light");
            }
          });
      });
    </script>
  </head>
  <body>
    <main class="flex w-full h-screen">
      <!-- <div
        class="w-58 min-w-58 flex flex-col border-r border-divider px-2 bg-subtle-1"
      >
        <div class="flex items-center sticky top-0 py-1 mb-1">
          <button class="btn--icon">{{ template "search.html" . }}</button>
          <button class="ml-auto btn--icon">
            {{ template "panel-right.html" . }}
          </button>
          <button class="btn--icon">{{ template "plus.html" . }}</button>
        </div>

        <div class="overflow-y-auto text-xs flex flex-col items-start">
          {{ range .Boards }}
          <div
            class="flex gap-1.5 items-center p-2 text-ink-body hover:text-ink hover:bg-subtle-2 rounded-lg w-full"
          >
            {{ template "hashtag.html" . }}
            <span class="truncate leading-snug"> {{.Name}} </span>
          </div>
          {{ end }}
        </div>
        <div class="flex items-center mt-auto mb-2">
          <div class="btn--block">
            <button class="btn text-[1.325em]">
              {{ template "avatar.html" "A" }}
            </button>
            <span class="ml-1.5 text-xs">Andrei</span>
          </div>
          <button class="ml-auto btn--icon text-base">
            {{ template "cog.html" . }}
          </button>
        </div>
      </div> -->

      <!-- Board -->
      <div class="grow flex flex-col min-w-0">
        <!-- Added min-w-0 to prevent overflow -->
        <!-- Fixed Header -->
        <div class="sticky top-0 z-10 px-6">
          <!-- Added bg-white for visibility when scrolling -->
          <div class="flex items-center mt-1 mb-2">
            <div class="text-xs font-semibold">Syncwave Core</div>
            <button class="ml-auto btn--icon">
              {{ template "search.html" . }}
            </button>
            <button class="btn--icon">{{ template "plus.html" . }}</button>
          </div>
        </div>

        <!-- Scrollable Tasks Container -->
        <div class="flex-1 overflow-auto">
          <!-- Changed to flex-1 -->
          <div class="flex gap-6 text-xs pb-4 px-6">
            <!-- Added padding-bottom -->
            <!-- Backlog Column -->
            <div class="w-58 flex-shrink-0">
              <!-- Added flex-shrink-0 -->
              <div class="mb-2 text-ink-body text-2xs">Backlog</div>
              <div class="flex flex-col gap-2">
                {{ range seq 8 }} {{ template "boards/task-tile.html" . }} {{
                end }}
              </div>
            </div>
            <!-- In Progress Column -->
            <div class="w-58 flex-shrink-0">
              <div class="mb-2 text-ink-body text-2xs">In Progress</div>
              <div class="flex flex-col gap-2">
                {{ range seq 4 }} {{ template "boards/task-tile.html" . }} {{
                end }}
              </div>
            </div>
            <!-- Review Column -->
            <div class="w-58 flex-shrink-0">
              <div class="mb-2 text-ink-body text-2xs">Review</div>
              <div class="flex flex-col gap-2">
                {{ range seq 8 }} {{ template "boards/task-tile.html" . }} {{
                end }}
              </div>
            </div>
            <!-- Done Column -->
            <div class="w-58 flex-shrink-0">
              <div class="mb-2 text-ink-body text-2xs">Done</div>
              <div class="flex flex-col gap-2">
                {{ range seq 6 }} {{ template "boards/task-tile.html" . }} {{
                end }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- New Task Sidebar -->
      <div
        class="w-152 min-w-124 flex flex-col border-l border-divider-layout z-10"
      >
        <div class="flex items-center sticky top-0 mt-1 mb-2 mx-6">
          <div class="text-xs font-semibold">SYNC-1</div>
          <button class="ml-auto btn--icon">
            {{ template "ellipsis.html" . }}
          </button>
          <button class="btn--icon">{{ template "times.html" . }}</button>
        </div>
        <div class="overflow-y-auto mx-6">
          <textarea
            class="input text-xs leading-relaxed"
            rows="5"
            placeholder="Write here..."
          ></textarea>
        </div>
        <div class="flex gap-2 my-2 mx-6">
          <div class="btn--block">
            {{ template "circle-dashed.html" . }}
            <span class="ml-1.5 text-xs">In Progress</span>
          </div>
          <div class="btn--block">
            <span class="text-[1.325em]">
              {{ template "avatar.html" "A" }}
            </span>
            <span class="ml-1.5 text-xs">Andrei Andreev</span>
          </div>
        </div>
        <hr class="my-2" />
        <!-- Messages Section -->
        <div class="flex flex-col flex-grow mx-6">
          <div class="flex-grow py-2">
            <div class="flex justify-center items-center mb-4">
              <div class="bg-subtle-1 px-2 py-0.5 rounded-xl text-3xs">
                <span class="font-semibold">Andrei</span>
                <span class="text-ink-detail">created Feb 23, 2023</span>
              </div>
            </div>
            {{ range seq 6 }}
            <div class="flex flex-col mb-4">
              <div class="flex gap-1.5 items-center">
                <div class="text-[1.325em]">
                  {{ template "avatar.html" "A" }}
                </div>
                <div class="flex items-baseline gap-1.5">
                  <div class="text-3xs font-semibold">Andrei</div>
                  <div class="text-4xs text-ink-detail">2h ago</div>
                </div>
              </div>
              <div class="text-xs ml-[calc(1.325em+0.5rem)]">
                Assigned to me, starting now.
              </div>
            </div>

            {{ end }}
          </div>
          <!-- Fixed Message Input -->
          <div
            class="flex items-center gap-1 border border-divider rounded-md bg-subtle-2 p-1 mb-2"
          >
            <button class="btn--icon">{{ template "attach.html" }}</button>
            <textarea
              class="input text-xs"
              rows="1"
              placeholder="Type a message..."
            ></textarea>
            <button class="btn--icon btn--icon--ink mt-auto">
              {{ template "arrow-up.html" }}
            </button>
          </div>
        </div>
      </div>
    </main>
  </body>
</html>
